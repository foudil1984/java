var CityObj = {
    dzORN2fr: 'Oran',
    maCAS2fr: 'oran',
    maFEZ2fr: 'alger',
    maRAK2fr: 'annaba',
};
var waitElm = async _0x11a699 => {
    return new Promise(_0x358e17 => {
        var _0xda292 = setInterval(() => {
            if (!document.querySelector(_0x11a699)) {
                return;
            }
            clearInterval(_0xda292);
            console.log(_0x11a699, ' Displayed');
            _0x358e17(true);
        }, 200);
    });
};
var ClickConfirm = async () => {
    await waitElm('.tls-time-unit');
    if (document.querySelector('.-available')) {
        return;
    }
    await waitElm('.tls-popup-action button');
    console.log('im heree 1');
    document.querySelector('.tls-popup-action button').click();
    console.log('Im here 2');
};
var addRightOptions = async () => {
    await waitElm('.tls-navbar--slot:has(.tls-navbar-slot--myapplication)');
    document.querySelector('.TLSContainer').appendChild(document.querySelector('.tls-navbar--slot:has(.tls-navbar-slot--myapplication)'));
};
var rand = _0xe39846 => _0xe39846[~~(_0xe39846.length * Math.random())];
var hideCookiesBox = () => {
    var _0x5d61b9 = setInterval(() => {
        var _0x8afa6 = document.querySelector('.osano-cm-window');
        if (!_0x8afa6) {
            return;
        }
        clearInterval(_0x5d61b9);
        _0x8afa6.style.display = 'none';
    });
};
var blackList = ['You have been over-freshening the web page', 'Our appointment system is currently experiencing high demand', 'You have tried to log in too many times. For security reasons', 'Website is under high demand', 'Vous avez été temporairement bloqué pour'];
var GoToAppoLink = async () => {
    var {
        CurrentAccountCity: _0x115867
    } = await chrome.storage.local.get('CurrentAccountCity');
    _0x115867 = _0x115867 || 'maRAK2fr';
    var _0xc2baad = await fetch('https://visas-fr.tlscontact.com/services/customerservice/api/tls/formgroup?client=fr&issuer=' + _0x115867);
    if (!_0xc2baad.ok) {
        window.location.href = 'https://visas-fr.tlscontact.com/';
    }
    var _0x52bd21 = await _0xc2baad.json();
    if (_0x52bd21.length == 0) {
        indow.location.href = 'https://visas-fr.tlscontact.com/';
    }
    var _0x21b151 = _0x52bd21[0].fg_id;
    console.log('fg_id : ', _0x21b151);
    window.location.href = 'https://visas-fr.tlscontact.com/appointment/dz/' + _0x115867 + '/' + _0x21b151;
};
var checkIframe = async () => {
    var _0x41246f = await fetch(document.querySelector('iframe').src);
    var _0x2b5d07 = await _0x41246f.text();
    var _0x342426 = new DOMParser().parseFromString(_0x2b5d07, 'text/html');
    var _0x516e63 = _0x342426.querySelector('.captcha__human__title').innerText.includes('We want to make sure it is actually');
    if (_0x516e63) {
        return console.log('Normal');
    }
    console.log('BLOCKED: Proxy + Reload');
    await chrome.runtime.sendMessage({
        msg: 'REMOVE_COOKIES'
    });
    document.querySelector('.ChangeIp').click();
    setTimeout(() => {
        GoToAppoLink();
    }, 2500);
};
var sendTelegramUpdates = async (_0x1f6c88, _0x3ad640, _0x4427bc, _0x366a1e) => {
    var {
        NM_OPTION_ApposCount: _0x4ab456,
        NM_OPTION_ApposTime: _0x3ad0d6,
        NM_OPTION_City: _0x23e7b6,
        NM_OPTION_Email: _0x29c81e,
        TME_TOKEN: _0x526e53,
        FromId: _0x33d867
    } = await chrome.storage.local.get(['NM_OPTION_ApposCount', 'NM_OPTION_ApposTime', 'NM_OPTION_City', 'NM_OPTION_Email', 'TME_TOKEN', 'FromId']);
    if (!_0x526e53 || !_0x33d867) {
        return console.log('You have to link the extension with your Telegram...!');
    }
    _0x4ab456 = _0x4ab456 === undefined ? true : _0x4ab456;
    _0x23e7b6 = _0x23e7b6 === undefined ? true : _0x23e7b6;
    _0x29c81e = _0x29c81e === undefined ? true : _0x29c81e;
    _0x3ad0d6 = _0x3ad0d6 === undefined ? true : _0x3ad0d6;
    var _0x14121d = 'https://api.telegram.org/bot' + _0x526e53 + '/sendMessage?chat_id=' + _0x33d867 + "&text=\uD83D\uDD25[TLS FRANCE] Disponible \uD83D\uDD25 %0A %0A\t";
    if (_0x4ab456) {
        _0x14121d += "\u2705 Available Appointments : " + _0x1f6c88 + '%0A';
    }
    if (_0x3ad0d6) {
        _0x14121d += "\u2705 Appointment Time : " + _0x3ad640 + '%0A';
    }
    if (_0x23e7b6) {
        _0x14121d += "\u2705 City : " + _0x4427bc + '%0A';
    }
    if (_0x29c81e) {
        _0x14121d += "\u2705 Email : " + _0x366a1e + '%0A%0A';
    }
    _0x14121d += "\u27A1 SENT USING OKHTOBOT (KM) \uD83E\uDD91";
    chrome.runtime.sendMessage({
        msg: 'FETCH_URL',
        URL: _0x14121d
    });
};
var sendTelegramSS = async () => await chrome.runtime.sendMessage({
    msg: 'SEND_SS'
});
var init = async () => {
    var {
        isValid: _0x2562ef,
        BbuttonApp: _0x25d976,
        Btimer: _0x14dc8f,
        CONFIG: _0x326390,
        TableErrorDelay: _0x1fe926,
        Alarm: _0x24cdea
    } = await chrome.storage.local.get(['BbuttonApp', 'Btimer', 'isValid', 'CONFIG', 'TableErrorDelay', 'Alarm']);
    if (!_0x2562ef) {
        return console.log('unActivated!');
    }
    if (!_0x326390.TABLE_RELOAD) {
        return console.log('NOTF');
    }
    document.body.setAttribute('clearMode', 'true');
    hideCookiesBox();
    _0x1fe926 = Boolean(_0x1fe926) ? +_0x1fe926 : 20;
    _0x24cdea = _0x24cdea || '';
    if (blackList.find(_0x32fa3e => document.body.textContent.includes(_0x32fa3e))) {
        document.querySelector('.ChangeIp').click();
        setTimeout(() => window.location.reload(), 2500);
        console.log('Proxy + Reload');
    } else {
        if (document.title.includes('tlscontact.com')) {
            checkIframe();
        } else {
            if (!document.querySelector('#Bbutton')) {
                console.log('INJECTED myapp');
                ClickConfirm();
                console.log('Im here 3');
                sc = document.createElement('div');
                sc.innerHTML = "<div class='AppContainer'>\n\t\t\t\t\t\t\t<button id=\"Bbutton\" class='START'></button>\n\t\t\t\t\t\t</div>";
                document.body.appendChild(sc);
                console.log('Im here 4');
                var _0x1c534e = document.createElement('div');
                console.log('Im here 5');
                _0x1c534e.classList.add('AppoContainer');
                _0x1c534e.innerHTML = "\n\t\t\t\t\t\t\t<input value=\"-\" type='button' id=\"TMins\" class='MinsPlus'></input>\n\t\t\t\t\t\t\t<div id=\"TCurrent\" class='TCurrent'>5</div>\n\t\t\t\t\t\t\t<input value=\"+\" type='button' id=\"TPlus\" class='MinsPlus'></input>";
                console.log('PICKER : ', document.querySelector('.tls-appointment-time-picker'));
                document.body.insertAdjacentElement('afterBegin', _0x1c534e);
                console.log('Im here 66');
                var _0x58a105 = document.querySelector('#TMins');
                var _0x57678d = document.querySelector('#TCurrent');
                var _0x382519 = document.querySelector('#TPlus');
                var _0x858df5 = document.createElement('div');
                _0x858df5.innerHTML = "<div class='TLSContainer'></div>";
                document.body.appendChild(_0x858df5);
                addRightOptions();
                var _0x2ca332 = (_0x707cc1, _0x13c519) => {
                    if (_0x13c519 == 'First') {
                        return _0x707cc1[0];
                    }
                    if (_0x13c519 == 'Last') {
                        return _0x707cc1.at(-1);
                    }
                    if (_0x13c519 == 'Middle') {
                        return _0x707cc1[Math.floor(_0x707cc1.length / 2)];
                    }
                    if (_0x13c519 == 'Random') {
                        return rand(_0x707cc1);
                    }
                };
                var _0xca090b = document.querySelector('#Bbutton');
                var _0x85a1bf;
                var _0x40855b = async () => {
                    var _0x77777b = new URL(window.location.href).host;
                    var _0x5d5136 = _0x77777b.split('-')[1].split('.')[0];
                    var _0x10c209 = document.location.href.split('/dz/')[1].split('/');
                    var _0x5d9190 = await fetch('https://' + _0x77777b + '/services/customerservice/api/tls/forms/list/' + _0x5d5136 + '/' + _0x10c209[0] + '?fg_id=' + _0x10c209[1]);
                    if (!_0x5d9190.ok) {
                        var _0x4eff60 = [{
                            fi_appointment_type: 'Grand Public PRIMO'
                        }];
                    } else {
                        var _0x4eff60 = await _0x5d9190.json();
                    }
                    console.log('AccountInfo : ', _0x4eff60);
                    var _0x5ecb65 = await fetch('https://' + _0x77777b + '/services/customerservice/api/tls/appointment/dz/' + _0x10c209[0] + '/table?client=' + _0x5d5136 + '&formGroupId=' + _0x10c209[1] + '&appointmentType=' + _0x4eff60[0].fi_appointment_type + '&appointmentStage=appointment');
                    var _0x4487d9 = await _0x5ecb65.json();
                    if (_0x4487d9.status) {
                        return false;
                    }
                    var _0x4dac8b = Object.keys(_0x4487d9).slice(0, 14).map(_0x2a100d => Object.values(_0x4487d9[_0x2a100d]).filter(_0x5aeee8 => _0x5aeee8 != 0).length).reduce((_0xd123a6, _0x3d4079) => _0xd123a6 + _0x3d4079);
                    console.log('appoList : ', _0x4487d9);
                    console.log('DispoAppos : ', _0x4dac8b);
                    return _0x4dac8b > 0;
                };
                var _0x57e966 = async () => {
                    var {
                        BbuttonApp: _0x4684a4,
                        BulkMode: _0x2186a2,
                        Btimer: _0x5edaa1
                    } = await chrome.storage.local.get(['BbuttonApp', 'BulkMode', 'Btimer']);
                    if (_0x4684a4 == 'Start') {
                        return;
                    }
                    _0x5edaa1 = _0x5edaa1 || 5;
                    _0x2186a2 = _0x2186a2 || 'BulkDisable';
                    try {
                        var _0x1aca00 = await _0x40855b();
                        console.log('isDispoAvailable : ', _0x1aca00);
                        if (_0x1aca00) {
                            if (_0x2186a2 == 'Checker') {
                                await chrome.runtime.sendMessage({
                                    msg: 'SEND_SIGNAL'
                                });
                            }
                            console.log('Appointment Table Reloaded!');
                            Notiflix.Notify.info('Dispo Appointments!');
                            location.reload();
                        } else {
                            console.log('NO DISCONNECT YET: KEEP RELOAING...');
                            Notiflix.Notify.success('Appointment Table Reloaded');
                            setTimeout(() => _0x57e966(), _0x5edaa1 * 1000);
                        }
                    } catch {
                        console.log('IDK ERROR');
                        document.querySelector('.ChangeIp').click();
                        setTimeout(() => _0x57e966(), _0x5edaa1 * 1000);
                    }
                };
                var _0x1cf9b9 = (_0x5725be, _0x598177) => {
                    return new Promise(_0x2d6527 => {
                        var _0x39857f = setInterval(() => {
                            if (_0x5725be == document.querySelector(_0x598177).textContent) {
                                return;
                            }
                            clearInterval(_0x39857f);
                            _0x2d6527(true);
                        }, 100);
                    });
                };
                var _0x107bfa = _0x550ecd => new Promise(_0x1a8ad9 => setTimeout(_0x1a8ad9, _0x550ecd));
                var _0x8aefc9 = async _0x4f692c => {
                    var {
                        BbuttonApp: _0x4edd4d,
                        BookByPosition: _0x28ac96,
                        Alarm: _0x578c62,
                        Btimer: _0x121876,
                        AppointmentTable: _0x45e790,
                        FullPage: _0x1cf83b,
                        ProxyRotation: _0xa9ba4e,
                        DISPO_PROXY_CHANGE: _0x3e7531,
                        BulkMode: _0x41b68e,
                        TelegramOption: _0x2e4f46,
                        PageScreenshot: _0x535a88
                    } = await chrome.storage.local.get(['BbuttonApp', 'BookByPosition', 'Alarm', 'Btimer', 'AppointmentTable', 'FullPage', 'ProxyRotation', 'DISPO_PROXY_CHANGE', 'BulkMode', 'TelegramOption', 'PageScreenshot']);
                    _0x28ac96 = _0x28ac96 || 'First';
                    _0x45e790 = _0x45e790 || false;
                    _0x1cf83b = _0x1cf83b || false;
                    _0xa9ba4e = _0xa9ba4e || false;
                    _0x3e7531 = _0x3e7531 || false;
                    _0x41b68e = _0x41b68e || 'BulkDisable';
                    _0x2e4f46 = _0x2e4f46 || false;
                    _0x535a88 = _0x535a88 || false;
                    console.log('BookByPosition : ', _0x28ac96);
                    console.log('AppointmentTable : ', _0x45e790);
                    console.log('FullPage : ', _0x1cf83b);
                    console.log('ProxyRotation : ', _0xa9ba4e);
                    var _0x1bdf69 = _0x121876 || 5;
                    if (_0x4edd4d == 'Start') {
                        return;
                    }
                    var _0x54722e = document.getElementsByClassName('-available');
                    if (_0x54722e.length > 0) {
                        if (_0x41b68e == 'Checker') {
                            await chrome.runtime.sendMessage({
                                msg: 'SEND_SIGNAL'
                            });
                        }
                        var _0x159f04 = Array.from(document.querySelectorAll('.-available'));
                        var _0x4b29db = _0x2ca332(_0x159f04, _0x28ac96);
                        if (!_0x4b29db) {
                            return console.log('date wrong!');
                        }
                        console.log('targetElement : ', _0x4b29db);
                        if (_0x3e7531) {
                            document.querySelector('.ChangeIp').click();
                            await _0x107bfa(2000);
                        }
                        if (_0x535a88) {
                            await sendTelegramSS();
                        }
                        _0x4b29db.click();
                        await waitElm("[data-tls-value=\"confirm\"]");
                        document.querySelector("[data-tls-value=\"confirm\"]").click();
                        try {
                            var _0x5d717b = await fetch('https://visas-fr.tlscontact.com/api/account');
                            var _0x4b4ca0 = await _0x5d717b.json();
                            var _0x2b7d7f = _0x4b4ca0.email;
                        } catch {
                            var _0x2b7d7f = 'None';
                        }
                        var _0x4b497e = document.location.href.split('/dz/')[1].split('/')[0];
                        var _0xf16ea0 = "https://api.telegram.org/bot5412590753:AAEJvzt_X7Qwb09CRBmUym29KIyczrdAZ3U/sendMessage?chat_id=1083035400&text=\uD83D\uDD25 [TLS FRANCE] Disponible \uD83D\uDD25 %0A %0A\t\u2705 Available Appointments : " + _0x54722e.length + "%0A\u2705 Appointment Time : " + _0x4b29db.innerText + " %0A\u2705 City : " + CityObj[_0x4b497e] + "%0A\u2705 Email : " + _0x2b7d7f;
                        chrome.runtime.sendMessage({
                            msg: 'FETCH_URL',
                            URL: _0xf16ea0
                        });
                        if (_0x2e4f46) {
                            sendTelegramUpdates(_0x54722e.length, _0x4b29db.innerText, CityObj[_0x4b497e], _0x2b7d7f);
                        }
                        if (!_0x578c62) {
                            return console.log('No Alarm');
                        }
                        open('https://soundcloud.com/sepehr-dark/soundhelix-song-1');
                    } else {
                        if (!_0x4f692c) {
                            var _0xb73d9c = document.querySelector('.tls-time-group--header-title').textContent;
                            document.querySelector('.tls-time-picker button.tls-time-picker--arrow').click();
                            await _0x1cf9b9(_0xb73d9c, '.tls-time-group--header-title');
                            _0x8aefc9(_0x4f692c = true);
                        } else {
                            console.log(' NO DISPOS: RELOADING THE TABLE ONLY...');
                            await _0x107bfa(_0x1bdf69 * 1000);
                            if (_0xa9ba4e) {
                                document.querySelector('.ChangeIp').click();
                                await _0x107bfa(2000);
                            }
                            if (_0x1cf83b) {
                                window.location.href = window.location.href;
                            } else {
                                if (_0x45e790) {
                                    _0x57e966();
                                } else {
                                    console.log('No Mode Activated...!');
                                }
                            }
                        }
                    }
                };
                var _0x1aa694 = () => {
                    _0xca090b.innerHTML = 'Start';
                    chrome.storage.local.set({
                        BbuttonApp: 'Start'
                    });
                    console.log('[CURRENT STATUS APP : Start]');
                    chrome.storage.local.set({
                        Bbutton: 'Start'
                    });
                    console.log('switch2Stop [Bbutton | CURRENT STATUS : Start]');
                    autosubmit = true;
                };
                var _0x38a2a2 = () => {
                    chrome.storage.local.set({
                        BbuttonApp: 'Stop'
                    });
                    console.log('switch2Stop [BbuttonApp | CURRENT STATUS APP : Stop]');
                    _0xca090b.innerHTML = 'Stop';
                    _0x8aefc9(isLastPage = true);
                };
                _0xca090b.onclick = () => {
                    clearTimeout(_0x85a1bf);
                    chrome.storage.local.get('BbuttonApp', _0x418974 => {
                        if (_0x418974.BbuttonApp == 'Stop') {
                            _0x1aa694();
                        } else {
                            _0x38a2a2();
                        }
                    });
                };
                _0x58a105.onclick = () => {
                    var _0x4d7fa4 = parseInt(_0x57678d.innerHTML.replace('s', '')) - 1;
                    _0x4d7fa4 = _0x4d7fa4 >= 1 ? _0x4d7fa4 : 0.01;
                    chrome.storage.local.set({
                        Btimer: _0x4d7fa4
                    });
                    _0x57678d.innerHTML = _0x4d7fa4 + 's';
                };
                _0x382519.onclick = () => {
                    var _0x1e4054 = parseInt(_0x57678d.innerHTML.replace('s', '')) + 1;
                    _0x1e4054 = _0x1e4054 == 1.01 ? 1 : _0x1e4054;
                    chrome.storage.local.set({
                        Btimer: _0x1e4054
                    });
                    _0x57678d.innerHTML = _0x1e4054 + 's';
                };
                await waitElm('.tls-appointment');
                await waitElm('#tls-navbar');
                document.querySelector('.tls-appointment').appendChild(document.querySelector('#tls-navbar'));
                _0x14dc8f = _0x14dc8f || 5;
                _0x57678d.innerHTML = _0x14dc8f + 's';
                _0xca090b.innerHTML = _0x25d976 || 'Start';
                console.log('Error Refresh Delay : ', _0x1fe926);
                var _0xa0a03 = false;
                setTimeout(() => {
                    if (_0xa0a03) {
                        return console.log('Table[Yes]');
                    }
                    console.log('No Table = Reload');
                    document.querySelector('.ChangeIp').click();
                    setTimeout(() => {
                        window.location.href = window.location.href;
                    }, 2500);
                }, _0x1fe926 * 1000);
                await waitElm('.tls-time-picker--time-group');
                _0xa0a03 = true;
                if (_0x25d976 == 'Stop') {
                    _0x38a2a2();
                }
            } else {
                alert('CONTACT DEV PLEASE...!');
            }
        }
    }
};
init();
